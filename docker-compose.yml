services:
  # 1. Telegram Bot Service
  bot:
    build: .
    container_name: datahive_bot
    command: python -m src.bot.main
    volumes: &app_volumes
      # --- ВАЖНО: Маппинг реальной структуры из structure.md ---
      # 1. Основное хранилище (Obsidian Vault пользователя)
      - ./users/${USER_NAME:-lexey}:/app/data/vault
      # 2. Временные файлы
      - ./temp:/app/data/temp
      # 3. Конфигурация бота (сессии, куки)
      - ./bot_state:/app/data/config
      # 4. Логи
      - ./logs:/app/logs
      # 5. Auth/Secrets mapping if they are files
      - ./auth.json:/app/auth.json
      - ./.env:/app/.env
      - ./src:/app/src

    environment: &app_env
      # Настройки путей внутри контейнера
      - DATA_DIR=/app/data
      - OUTPUT_DIR=/app/data/vault/downloads
      - TEMP_DIR=/app/data/temp
      # Настройки доступа
      - OLLAMA_HOST=${OLLAMA_HOST:-http://host.docker.internal:11434}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      # MCP Settings (Bot needs to know where MCP is if it talks to it, or shares env)
    restart: unless-stopped

